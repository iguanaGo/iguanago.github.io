"use strict";angular.module("iguanagoApp",["ngAnimate","ngCookies","ngResource","ui.router","ngSanitize","ngTouch","Tabletop"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("main",{url:"/",templateUrl:"views/landing.html",controller:"LandingCtrl"}).state("flights",{url:"/flights",templateUrl:"views/flights.html",controller:"FlightsCtrl"}).state("destinations",{url:"/destinations",templateUrl:"views/destinations.html",controller:"DestinationsCtrl"})}]),angular.module("iguanagoApp").controller("FlightsCtrl",["$scope","flightService",function(a,b){a.viewMode="fl-vm-view-grid",a.viewSelected="grid",a.getSelected=function(b){switch(b){case a.viewSelected:return"fl-vm-selected";default:return""}},b.getFlights().then(function(b){a.flights=b[0]})}]),angular.module("iguanagoApp").controller("LandingCtrl",["$scope","$state",function(a,b){a.goToDestinations=function(){b.go("destinations")}}]),angular.module("iguanagoApp").service("flightService",["$http","$q",function(a,b){function c(){var a=b.defer();return window.Tabletop.init({key:"https://docs.google.com/spreadsheets/d/1MNkEoLahoi_6bjwi0QkU9-SkYirnI_13jaH63k2Ogok/pubhtml?gid=0&single=true",simpleSheet:!0,callback:function(b,c){a.resolve([b,c])}}),a.promise}return{getFlights:function(){return c()}}}]),angular.module("iguanagoApp").controller("DestinationsCtrl",["$scope",function(a){function b(a){function b(a){return a.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(a,b){return 0===+a?"":0==b?a.toLowerCase():a.toUpperCase()})}var c={};return $.each(a.geometries,function(a,d){void 0===c[b(d.properties.subregion)]&&(c[b(d.properties.subregion)]={type:"GeometryCollection",geometries:[]}),c[b(d.properties.subregion)].geometries.push(d)}),c}function c(a){var b,c,h;if(a&&d!==a){var i=k.centroid(a);b=i[0],c=i[1],h=4,d=a}else b=e/2,c=f/2,h=1,d=null;g.selectAll("path").classed("active",d&&function(a){return a===d}),g.transition().duration(750).attr("transform","translate("+e/2+","+f/2+")scale("+h+")translate("+-b+","+-c+")").style("stroke-width",1.5/h+"px")}var d,e=960,f=500,g=d3.select("#world-map").append("svg").attr("width","100%").attr("height",f),h=g.append("g").attr("class","countries"),i=g.append("g").attr("class","arcs"),j=(g.append("g").attr("class","points"),d3.geo.miller().scale(153).translate([e/2,f/1.5])),k=d3.geo.path().projection(j);d3.json("./resources/world.json",function(a,d){if(a)return console.error(a);var e=b(d.objects.countries);$.each(e,function(a,b){var e=h.append("g").attr("id",a);e.selectAll(".countries").data(topojson.feature(d,b).features).enter().append("path").attr("class",function(a){return"country "+a.id}).attr("d",k).on("click",c)});var f=function(a){a.transition().duration(4e3).attrTween("stroke-dasharray",g).each("end",function(a,b){})},g=function(){var a=this.getTotalLength(),b=d3.interpolateString("0,"+a,a+","+a);return function(a){return b(a)}},j=[{type:"LineString",coordinates:[[-58.381667,-34.603333],[-3.716667,40.383333]]},{type:"LineString",coordinates:[[-58.381667,-34.603333],[13.383333,52.516667]]},{type:"LineString",coordinates:[[-58.381667,-34.603333],[-74.00597,40.71427]]}],l=i.selectAll(".arc").data(j);l.enter().append("path").attr({"class":"arc"}),l.attr({d:k}).call(f),l.exit().remove()})}]);